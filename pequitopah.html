<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="color-scheme" content="light dark" />
<title>Pequitopah Randomizer - Agenda de Restaurantes üçΩÔ∏è</title>
<style>
  /* Modern palette tokens (light default) */
  :root{
    --bg:#F1EFEC;
    --surface:#D4C9BE;
    --accent:#123458;
    --text:#030303;
    --highlight-bg:#123458;
    --highlight-fg:#F1EFEC;
    --ring:#0b223e33;
  }
  @media (prefers-color-scheme: dark){
    :root{
      --bg:#030303;
      --surface:#123458;
      --accent:#D4C9BE;
      --text:#F1EFEC;
      --highlight-bg:#D4C9BE;
      --highlight-fg:#030303;
      --ring:#ffffff26;
    }
  }
  /* Base reset + typography */
  *, *::before, *::after { box-sizing: border-box; }
  html, body{
    background:var(--bg);
    color:var(--text);
    font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
    line-height:1.5;
    margin:0; padding:0;
  }
  body{
    min-height:100vh;
    display:flex;
    flex-direction:column;
    justify-content:flex-start;
  }
  h1{
    font-size:clamp(1.6rem, 1.3rem + 1.5vw, 2.4rem);
    margin: 24px auto 8px;
    text-align:center;
    letter-spacing:0.2px;
  }
  /* Centered page wrapper */
  .page-wrap{
    padding-inline:16px;
    max-width:1200px;
    margin-inline:auto;
  }
  /* Main container */
  .main-container{
    display: flex;
    gap: 20px;
    margin-top: 20px;
    align-items: flex-start;
  }
  /* FLEXBOX: ensures blocks stay side by side */
  .blocks{
    display: flex;
    gap: 16px;
    align-items: flex-start;
    flex-wrap: nowrap;
    flex: 1;
  }
  /* Cards take equal width and fill available space */
  .block{
    flex: 1;
    min-width: 0;
    font-size: 1rem;
    padding: 14px;
    background: var(--surface);
    border-radius: 14px;
    border: 1px solid transparent;
    box-shadow: 0 6px 14px rgba(0,0,0,0.08);
  }
  @media (max-width: 768px) {
    .blocks {
      flex-direction: column;
    }
  }
  .block h3{
    margin:0 0 10px 0;
    font-size:1.05rem;
  }
  /* Entries */
  .entry{
    margin-bottom:12px;
    padding-bottom:10px;
    border-bottom:1px dashed rgba(18,52,88,0.3);
    transition: opacity 0.3s ease;
  }
  .entry-title{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:8px;
    margin:0 0 6px 0;
  }
  .entry-buttons{
    display:flex;
    gap:6px;
  }
  .rest-line{
    margin-top:6px;
    padding:6px 8px;
    background: rgba(255,255,255,0.35);
    border:1px dashed rgba(18,52,88,0.35);
    border-radius:10px;
  }
  .rest-wrap{ margin-top:6px; }
  .rest-input{
    width:100%;
    box-sizing:border-box;
    padding:8px 10px;
    border:1px solid var(--ring);
    border-radius:10px;
    background: rgba(255,255,255,0.45);
    color:var(--text);
    font-size:0.95rem;
    outline:none;
  }
  .rest-input::placeholder{ color: rgba(3,3,3,0.45); }
  .edit-btn{
    padding:4px 10px;
    font-size:0.85rem;
    border:1px solid var(--ring);
    border-radius:10px;
    background: rgba(255,255,255,0.35);
    color:var(--text);
    cursor:pointer;
    transition: background-color 120ms ease, transform 120ms ease, border-color 120ms ease;
  }
  .edit-btn:hover{ 
    transform: translateY(-1px); 
  }
  .edit-btn.active{ background: rgba(255,255,255,0.5); }
  /* Today highlight */
  .is-today{
    background:var(--highlight-bg);
    color:var(--highlight-fg);
    border:1px solid var(--highlight-bg);
    box-shadow: 0 8px 20px rgba(0,0,0,0.16);
  }
  /* Footer and image */
  footer{
    margin-top:auto;
    font-size:0.9rem;
    text-align:center;
    padding:20px 0 30px;
  }
  .hero-gif{
    width: 220px;
    height: 220px;
    max-width: 90%;
    object-fit: cover;
    display: block;
    margin: 8px auto 10px;
    border-radius: 12px;
    box-shadow: 0 6px 14px rgba(0,0,0,0.12);
  }
</style>
</head>
<body>
  <h1>Pequitopah Melhor APP do Mundo üçΩÔ∏è</h1>

  <div class="page-wrap">
    <div class="main-container">
      <!-- Blocks container -->
      <div class="blocks" id="blocks"></div>
    </div>
  </div>

  <footer>
    <img
      class="hero-gif"
      src="https://media1.giphy.com/media/v1.Y2lkPTc5MGI3NjExNzE0d24wZzEzcG4yZG05aDBwZ3R3M21la2o1M2EwejI4c25iaTM3cCZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/SAAMcPRfQpgyI/giphy.gif"
      alt="Gif divertido"
    />
    Desenvolvido para o melhor almo√ßo do escrit√≥rio! üòÑ
  </footer>

<script>
  const blocks = document.getElementById('blocks');

  function proximoDiaUtil(data){
    const dia = data.getDay();
    if (dia === 5){          // sexta -> +3
      data.setDate(data.getDate() + 3);
    } else if (dia === 6){   // s√°bado -> +2
      data.setDate(data.getDate() + 2);
    } else if (dia === 0){   // domingo -> +1
      data.setDate(data.getDate() + 1);
    } else {                 // dia √∫til -> +1
      data.setDate(data.getDate() + 1);
    }
    return data;
  }

  function formatarData(date){
    const diasSemana = ['domingo','segunda-feira','ter√ßa-feira','quarta-feira','quinta-feira','sexta-feira','s√°bado'];
    const dd = String(date.getDate()).padStart(2,'0');
    const mm = String(date.getMonth()+1).padStart(2,'0');
    const yyyy = date.getFullYear();
    const diaNome = diasSemana[date.getDay()];
    return `${dd}/${mm}/${yyyy} (${diaNome})`;
  }

  function calcularBlocoComConstraints(titulo, nomes, dataInicio, startingQueueIndex = 0) {
    let data = new Date(dataInicio);
    const entries = [];
    const availablePeople = [...nomes];
    let queueIndex = startingQueueIndex;
    let dateIndex = 0;
    const maxDates = 70;

    while (entries.length < nomes.length && dateIndex < maxDates) {
      const dataObj = new Date(data);
      const dataISO = dataObj.toISOString().slice(0,10);
      let assignedPerson = null;
      let assignedIndex = null;

      for (let i = 0; i < availablePeople.length; i++) {
        const candidateIndex = (queueIndex + i) % availablePeople.length;
        const candidate = availablePeople[candidateIndex];

        // If Pavel would be assigned on Tuesday, try to find Guilherme to switch
        if (candidate.toLowerCase() === 'pavel' && dataObj.getDay() === 2) {
          // Look for Guilherme in available people
          const guilhermeIndex = availablePeople.findIndex(person => person.toLowerCase() === 'guilherme');
          if (guilhermeIndex !== -1) {
            assignedPerson = 'Guilherme';
            assignedIndex = guilhermeIndex;
            break;
          }
          // If Guilherme is not available, continue to next candidate
          continue;
        }

        assignedPerson = candidate;
        assignedIndex = candidateIndex;
        break;
      }

      if (assignedPerson !== null) {
        entries.push({
          titulo,
          idx: entries.length + 1,
          nome: assignedPerson,
          data: new Date(dataObj),
          dataISO,
          dataLabel: formatarData(dataObj),
          key: `rest__${assignedPerson}__${dataISO}`
        });

        availablePeople.splice(assignedIndex, 1);

        if (queueIndex >= availablePeople.length && availablePeople.length > 0) {
          queueIndex = 0;
        }
      }

      data = proximoDiaUtil(new Date(data));
      dateIndex++;
    }

    const finalQueueIndex = queueIndex % nomes.length;
    return { entries, dataFim: data, nextQueueIndex: finalQueueIndex };
  }

  function shouldShiftBlocks() {
    const baseDate = new Date(2025, 8, 29);
    const todayISO = new Date().toISOString().slice(0,10);
    const nomes = ["Pavel","Guilherme","Victor","Chris","Alan","Thiago","Clayton","Carolina"]; // Removed Daniel

    let { dataFim } = calcularBlocoComConstraints("Bloco 1", nomes, baseDate, 0);
    const block2StartISO = dataFim.toISOString().slice(0,10);
    const today = new Date(todayISO);
    const block2Start = new Date(block2StartISO);

    return today >= block2Start;
  }

  function getShiftedStartDate() {
    const baseDate = new Date(2025, 8, 29);
    const nomes = ["Pavel","Guilherme","Victor","Chris","Alan","Thiago","Clayton","Carolina"]; // Removed Daniel

    if (shouldShiftBlocks()) {
      let { dataFim } = calcularBlocoComConstraints("Bloco 1", nomes, baseDate, 0);
      return dataFim;
    }
    return baseDate;
  }

  function calcularCiclos(){
    const nomes = ["Pavel","Guilherme","Victor","Chris","Alan","Thiago","Clayton","Carolina"]; // Removed Daniel
    const ciclos = 3;
    let dataAtual = getShiftedStartDate();
    let currentQueueIndex = 0;
    const todayISO = new Date().toISOString().slice(0,10);

    blocks.innerHTML = "";
    for (let i = 1; i <= ciclos; i++){
      const { entries, dataFim, nextQueueIndex } = calcularBlocoComConstraints(`Bloco ${i}`, nomes, dataAtual, currentQueueIndex);

      const card = document.createElement('div');
      card.className = 'block';

      const h3 = document.createElement('h3');
      h3.textContent = `Bloco ${i}`;
      card.appendChild(h3);

      entries.forEach((row) => {
        const container = document.createElement('div');
        container.className = 'entry';
        container.setAttribute('data-owner', row.nome.toLowerCase());
        container.setAttribute('data-date-iso', row.dataISO);
        container.setAttribute('data-weekday', String(row.data.getDay()));

        const title = document.createElement('div');
        title.className = 'entry-title';

        const titleText = document.createElement('span');
        titleText.textContent = `${row.idx}. ${row.nome} ‚Äî Dia: ${row.dataLabel}`;
        title.appendChild(titleText);

        const buttonContainer = document.createElement('div');
        buttonContainer.className = 'entry-buttons';

        const editBtn = document.createElement('button');
        editBtn.type = 'button';
        editBtn.className = 'edit-btn';

        buttonContainer.appendChild(editBtn);
        title.appendChild(buttonContainer);

        const restLine = document.createElement('div');
        restLine.className = 'rest-line';

        const restWrap = document.createElement('div');
        restWrap.className = 'rest-wrap';
        restWrap.hidden = true;

        const input = document.createElement('input');
        input.type = 'text';
        input.className = 'rest-input';
        input.placeholder = 'Digite o restaurante...';

        const keyStr = row.key;
        const saved = localStorage.getItem(keyStr) || '';
        input.value = saved;
        restLine.textContent = `Restaurante: ${saved}`;
        restLine.hidden = !saved;
        editBtn.textContent = saved ? '‚úé' : '‚ûï';
        editBtn.setAttribute('aria-label', saved ? 'Editar restaurante' : 'Adicionar restaurante');

        input.addEventListener('input', () => {
          const val = input.value.trim();
          localStorage.setItem(keyStr, val);
          restLine.textContent = `Restaurante: ${val}`;
          restLine.hidden = !val;
          editBtn.textContent = val ? '‚úé' : '‚ûï';
          editBtn.setAttribute('aria-label', val ? 'Editar restaurante' : 'Adicionar restaurante');
        });

        editBtn.addEventListener('click', () => {
          const nowHidden = !restWrap.hidden;
          restWrap.hidden = nowHidden ? true : false;
          editBtn.classList.toggle('active');
          if (!restWrap.hidden){
            input.focus();
            input.select();
          }
        });

        input.addEventListener('keydown', (ev) => {
          if (ev.key === 'Enter' || ev.key === 'Escape'){
            restWrap.hidden = true;
            editBtn.classList.remove('active');
          }
        });

        input.addEventListener('blur', () => {
          setTimeout(() => {
            restWrap.hidden = true;
            editBtn.classList.remove('active');
          }, 80);
        });

        restWrap.appendChild(input);
        container.appendChild(title);
        container.appendChild(restLine);
        container.appendChild(restWrap);

        if (row.dataISO === todayISO){
          container.classList.add('is-today');
        }

        card.appendChild(container);
      });

      blocks.appendChild(card);
      dataAtual = dataFim;
      currentQueueIndex = nextQueueIndex;
    }
  }

  calcularCiclos();
</script>
</body>
</html>